# redissyncer 一键部署制作过程

## 编译 redissyncer-server

* clone redissycer-server 并打包
  
```
git clone git@github.com:TraceNature/redissyncer-server.git
cd redissyncer-server
git checkout 3.3.3
mvn clean package -Ddockerfile.skip
```

* 启动 redissyncer-server
  
```
nohup java -jar -server -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=1 -Xms2000m syncer-webapp/redissyncer-server.jar --server.port=8080 --syncer.config.path.logfile=./log --syncer.config.path.datafile=/ --syncer.config.auth=false --management.endpoints.enabled-by-default=true &
```


## 功能测试


## 制作镜像

* clone redissycer-server 并打包
  
```shell
git clone git@github.com:TraceNature/redissyncer-server.git
cd redissyncer-server
git checkout 3.3.3
mvn clean package 
```

* 将docker image 上传至 dockerhub

```shell
docker push jiashiwen/redissyncer:3.3.3
```

## 修改docker-compose.yml

```yaml
# deploy local redissyncer service

version: "2.4"
services:
  redissyncer-server:
      image: jiashiwen/redissyncer:3.3.3
      #ports:
      #- "8000:80"
      network_mode: "host"
      mem_limit: 4g
      environment:
        JAVA_TOOL_OPTIONS: " -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=1 -Xms4000m"
        SPRING_ENV: "--server.port=8080 --syncer.config.path.logfile=/log --syncer.config.path.datafile=/ --syncer.config.auth=true --management.endpoints.enabled-by-default=true "
      volumes:
        - /etc/localtime:/etc/localtime:ro
        - ./log:/log
        - ./config:/config
        - ./data:/data
      container_name: redissyncer-server
```

## 编译客户端

* clone redissyncer-cli-rs

```shell
git clone https://github.com/TraceNature/redissyncer-cli-rs.git
cd redissyncer-cli-rs
git checkout 3.3.3
```

* 安装 cross 编译环境

```shell
cargo install -f cross
```

* 编译 windows 客户端
  
```shell
cross build --release --target x86_64-pc-windows-gnu
```

* 编译 linux 客户端
  
```shell
cargo build --release
```

* 复制编译好的客户端程序

```shell
cd redissyncer
cp ~/redissyncer-cli-rs/target/x86_64-pc-windows-gnu/release/redissyncer-cli-rs.exe redissyncer-cli/redissyncer-cli-rs.exe
cp ~/redissyncer-cli-rs/target/release/redissyncer-cli-rs redissyncer-cli/redissyncer-cli-rs-x86_64-linux
```

/Users/jiashiwen/javaprojects/redissyncer